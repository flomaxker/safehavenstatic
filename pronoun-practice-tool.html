<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dutch Pronoun Game | Safe Haven Dutch Coaching</title>
    <meta name="description" content="A fun, gamified tool to master Dutch pronouns. Earn badges, track high scores, and unlock challenges.">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="style.css">
    
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

    <!-- Custom styles for the interactive game -->
    <style>
        .tool-intro { text-align: center; margin-bottom: 2.5rem; }
        .game-field {
            background-color: var(--color-bg);
            padding: 2rem 2.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.07);
            border-left: 5px solid var(--color-primary);
            margin-bottom: 3rem;
        }
        #category-selection { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin-bottom: 2rem; }
        #category-selection .btn { min-width: 180px; }
        #start-screen {
            text-align: center;
            margin-bottom: 2rem;
        }
        #start-screen p { font-size: 1.1rem; margin-bottom: 1.5rem; }
        #start-screen .btn { margin-top: 0.5rem; }
        .game-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; height: 30px; }
        #hint-container { font-size: 1rem; color: var(--color-text-light); }
        #hint-btn { background: none; border: 1px solid var(--color-text-light); color: var(--color-text-light); padding: 0.2rem 0.6rem; border-radius: 4px; cursor: pointer; transition: all 0.2s ease; }
        #hint-btn:hover:not(:disabled) { background-color: var(--color-primary); color: var(--color-white); border-color: var(--color-primary); }
        #hint-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        #sound-toggle { background: none; border: 1px solid var(--color-text-light); color: var(--color-text-light); padding: 0.2rem 0.6rem; border-radius: 4px; cursor: pointer; transition: all 0.2s ease; }
        #sound-toggle:hover { background-color: var(--color-primary); color: var(--color-white); border-color: var(--color-primary); }
        #streak-counter { font-size: 1.5rem; color: var(--color-primary); font-weight: 700; }
        #sentence-container { font-size: 1.5rem; color: var(--color-heading); margin-bottom: 1.5rem; line-height: 1.6; text-align: center; min-height: 70px; }
        #answer-input { display: block; width: 100%; max-width: 400px; margin: 0 auto 1rem auto; padding: 0.75rem 1rem; border: 2px solid #d1d5db; border-radius: 6px; font-size: 1.2rem; text-align: center; font-family: var(--font-body); transition: all 0.3s; }
        #answer-input:focus { outline: none; border-color: var(--color-primary); }
        #answer-input.correct-answer { border-color: var(--color-secondary); background-color: #f0fdfa; }
        #answer-input.incorrect-answer { border-color: var(--color-accent); background-color: #fff1f2; }
        #hint-message { min-height: 1.2em; text-align: center; color: var(--color-text-light); margin-bottom: 0.5rem; }
        .action-buttons { display: flex; justify-content: center; gap: 1rem; margin-top: 1.5rem; }
        #feedback-message { min-height: 1.5em; margin-top: 1rem; text-align: center; font-weight: 600; }
        #feedback-message.correct { color: var(--color-secondary); }
        #feedback-message.incorrect { color: var(--color-accent); }
        #completion-screen { text-align: center; padding: 3rem 1.5rem; }
        #completion-stats { display: flex; justify-content: center; gap: 2rem; margin: 1rem 0 2rem 0; text-align: center; flex-wrap: wrap; }
        .stat-item h4 { color: var(--color-text-light); margin-bottom: 0.25rem; font-size: 1rem; font-weight: 500; }
        .stat-item p { color: var(--color-primary); font-size: 1.8rem; font-weight: 700; margin: 0; }
        .new-high-score {
            color: var(--color-accent);
            font-weight: 700;
            font-size: 1rem;
            margin-top: 0.25rem;
            display: block;
        }
        .hidden { display: none; }

        #timer-container { width: 100%; background-color: #fee2e2; border-radius: 8px; overflow: hidden; position: relative; height: 20px; margin-bottom: 1rem; }
        #timer-bar { height: 100%; width: 100%; background-color: var(--color-accent); transition: width 1s linear; }
        #timer-text { position: absolute; width: 100%; text-align: center; line-height: 20px; color: var(--color-white); font-weight: 600; top: 0; left: 0; pointer-events: none; }
        /* Achievements */
        #achievements-container { margin: 3rem auto; max-width: 600px; text-align: center; }
        #achievements-container h3 { color: var(--color-secondary); }
        .badge-grid { display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; margin-top: 1.5rem; }
        .badge { width: 100px; text-align: center; }
        .badge .icon { font-size: 3rem; border-radius: 50%; width: 70px; height: 70px; line-height: 70px; margin: 0 auto; transition: all 0.4s ease; }
        .badge .title { font-size: 0.8rem; font-weight: 600; margin-top: 0.5rem; }
        .badge.locked .icon { background-color: #e5e7eb; color: #9ca3af; }
        .badge.locked .title { color: #9ca3af; }
        .badge.unlocked .icon { background-color: var(--color-secondary); color: var(--color-white); transform: scale(1.1); box-shadow: 0 4px 10px rgba(20, 184, 166, 0.4); }
        .badge.unlocked .title { color: var(--color-heading); }

        /* Tooltip for locked button */
        [data-tooltip] { position: relative; }
        [data-tooltip]:hover::after { content: attr(data-tooltip); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background-color: #374151; color: white; padding: 0.5rem 1rem; border-radius: 4px; font-size: 0.85rem; white-space: nowrap; z-index: 10; margin-bottom: 5px; opacity: 1; transition: opacity 0.2s; }

        /* Toast Notification */
        .toast { position: fixed; top: 20px; right: 20px; background-color: var(--color-secondary); color: white; padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 2000; transform: translateX(120%); transition: transform 0.5s ease-in-out; }
        .toast.show { transform: translateX(0); }
        .toast .emoji { margin-right: 0.75rem; font-size: 1.2rem; }

        @media (max-width: 768px) {
            .game-field { padding: 1.5rem; }
            #category-selection { flex-direction: column; }
            #category-selection .btn { width: 100%; min-width: 0; }
            #start-screen p { font-size: 1rem; }
            #completion-screen { padding: 2rem 1rem; }
            #sentence-container { font-size: 1.2rem; }
            #answer-input { font-size: 1.1rem; }
        }
    </style>
</head>
<body id="page-pronoun-game">
    <header class="header">
        <nav class="navbar container">
             <a href="index.html" class="logo-link">
                 <img src="Safe Haven Banner (groot)-2.png" alt="Safe Haven Dutch Coaching Banner" class="logo-banner">
            </a>
            <ul class="nav-menu" id="nav-menu">
                <li><a href="index.html#home" class="nav-link">Home</a></li>
                <li><a href="index.html#about" class="nav-link">About Me</a></li>
                <li><a href="index.html#approach" class="nav-link">Approach</a></li>
                <li><a href="blog.html" class="nav-link">Blog</a></li>
                <li><a href="feelings-flags.html" class="nav-link">Feelings</a></li>
                <li><a href="integration-checklist.html" class="nav-link">Checklist</a></li>
                <li><a href="index.html#contact" class="nav-link">Contact</a></li>
            </ul>
            <button class="nav-toggle" id="nav-toggle" aria-label="Menu"><i class="fas fa-bars"></i></button>
        </nav>
    </header>

    <main class="blog-post-container">
        <div class="container tool-content">

            <div class="tool-intro">
                <h1><span class="emoji">üèÜ</span> The Great Pronoun Game</h1>
                <p class="intro-text">Master Dutch pronouns in a fun way! Choose a category, track your high scores, and unlock achievements. Veel succes!</p>
            </div>
            <div id="game-field" class="game-field">
            <div id='start-screen'>
                <h2><span class="emoji">üéÆ</span> Ready to Play?</h2>
                <p>Welcome! Press Start to choose a category. You'll answer 10 questions per round. Type the missing word and hit Enter. Use hints if you're stuck ‚Äî they reset your streak. Score 8/10 in each category to unlock Challenge Mode. Your progress saves automatically and you can toggle sounds with the speaker icon.</p>
                <button id='start-btn' class='btn btn-primary'>Start</button>
            </div>
            <!-- Category Selection -->
            <div id="category-selection" class="hidden">
                <button class="btn btn-primary" data-category="subject">Subject Pronouns</button>
                <button class="btn btn-primary" data-category="object">Object Pronouns</button>
                <button class="btn btn-secondary" data-category="demonstrative">Demonstratives</button>
                <button id="mixed-btn" class="btn btn-secondary" data-category="mixed" disabled>Challenge Mode</button>
            </div>

            <!-- The Practice Area -->
            <div id="practice-area" class="hidden">
                <div class="game-header">
                    <div id="hint-container">
                        <button id="hint-btn">Hint</button>
                        <span id="hint-counter"></span>
                    </div>
                    <button id="sound-toggle" aria-label="Toggle sound"><i class="fas fa-volume-up"></i></button>
                    <div id="streak-counter"></div>
                </div>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                    <div id="progress-text" class="progress-text"></div>
                </div>
                  <div id="timer-container" class="hidden">
                      <div id="timer-bar" class="timer-bar"></div>
                      <div id="timer-text" class="timer-text"></div>
                  </div>
                <div id="sentence-container"></div>
                <input type="text" id="answer-input" placeholder="Type your answer" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                <div id="hint-message" class="hint-message"></div>
                <div id="feedback-message"></div>
                <div class="action-buttons">
                    <button id="check-btn" class="btn btn-primary">Check Answer</button>
                    <button id="next-btn" class="btn btn-secondary hidden">Next Question</button>
                </div>
            </div>

            <!-- Completion Screen -->
            <div id="completion-screen" class="hidden">
                <h2><span class="emoji">üéâ</span> Round Complete!</h2>
                <div id="completion-stats">
                    <div class="stat-item">
                        <h4>Score</h4>
                        <p id="final-score">0 / 10</p>
                    </div>
                    <div class="stat-item">
                        <h4>Best Streak</h4>
                        <p id="final-streak">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>High Score</h4>
                        <p id="high-score">0 / 10</p>
                        <p id="new-high-score-message" class="new-high-score hidden">New Best!</p>
                    </div>
                </div>
                <button id="play-again-btn" class="btn btn-primary">Play Another Round</button>
                <button id="practice-mistakes-btn" class="btn btn-secondary hidden">Practice My Mistakes</button>
            </div> <!-- end completion-screen -->
            </div> <!-- end game-field -->

            <!-- Achievements -->
            <div id="achievements-container">
                <h3><i class="fas fa-medal"></i> Your Achievements</h3>
                <div class="badge-grid">
                    <div id="badge-beginner" class="badge locked" data-tooltip="Complete your first round">
                        <div class="icon"><i class="fas fa-seedling"></i></div>
                        <p class="title">Beginner</p>
                    </div>
                    <div id="badge-specialist" class="badge locked" data-tooltip="Get a perfect 10/10 score">
                        <div class="icon"><i class="fas fa-star"></i></div>
                        <p class="title">Specialist</p>
                    </div>
                    <div id="badge-onfire" class="badge locked" data-tooltip="Achieve a 5-answer streak">
                        <div class="icon"><i class="fas fa-fire"></i></div>
                        <p class="title">On Fire!</p>
                    </div>
                    <div id="badge-pro" class="badge locked" data-tooltip="Unlock and complete the Challenge Mode">
                        <div class="icon"><i class="fas fa-crown"></i></div>
                        <p class="title">Pronoun Pro</p>
                    </div>
                    <div id="badge-master" class="badge locked" data-tooltip="Unlock all achievements">
                        <div class="icon"><i class="fas fa-trophy"></i></div>
                        <p class="title">Master</p>
                    </div>
                </div>
            </div>
            
        </div>
    </main>

    <div id="toast" class="toast hidden"></div>
    <audio id="correct-sound"></audio>
    <audio id="incorrect-sound"></audio>
    <audio id="completion-sound"></audio>
    <audio id="highscore-sound"></audio>
    <footer class="footer"></footer>

    <script src="script.js"></script> <!-- Your existing script for nav/footer -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sentences = [
                { category: 'subject', sentence: '___ woon in een klein dorp.', answer: ['ik'], explanation: 'Use "ik" for the first person singular.' },
                { category: 'subject', sentence: 'Mijn broer heet David. ___ is 20 jaar oud.', answer: ['hij'], explanation: 'David is male, so we use "hij".' },
                { category: 'subject', sentence: 'De zon schijnt. ___ is warm vandaag.', answer: ['het'], explanation: 'Weather and conditions take "het".' },
                { category: 'subject', sentence: 'Mijn zus en ik gaan weg. ___ kopen kaartjes.', answer: ['wij', 'we'], explanation: 'For "my sister and I" use "wij" or "we".' },
                { category: 'subject', sentence: '(To a friend) Waarom drink ___ geen koffie?', answer: ['jij', 'je'], explanation: 'Informal singular "you" is "jij/je".' },
                { category: 'subject', sentence: '(To a group) Hebben ___ zin in een pizza?', answer: ['jullie'], explanation: 'Addressing a group uses "jullie".' },
                { category: 'subject', sentence: 'De buren zijn aardig. ___ hebben een hond.', answer: ['zij', 'ze'], explanation: 'Plural nouns take "zij/ze".' },
                { category: 'subject', sentence: '(Formal) Goedemorgen, heeft ___ een moment tijd?', answer: ['u'], explanation: 'Formal "you" is "u".' },
                { category: 'subject', sentence: 'Vandaag ga ___ vroeg naar huis.', answer: ['ik'], explanation: 'Talking about yourself again uses "ik".' },
                { category: 'subject', sentence: 'De kinderen spelen buiten. ___ maken veel lawaai.', answer: ['zij', 'ze'], explanation: '"De kinderen" is plural, so "zij/ze".' },
                { category: 'subject', sentence: 'Sarah en Tim gaan naar het park. ___ nemen hun hond mee.', answer: ['zij', 'ze'], explanation: 'Plural people use "zij/ze".' },
                { category: 'subject', sentence: 'Mijn collega is boos. ___ heeft een fout gemaakt.', answer: ['hij'], explanation: 'Male colleague -> "hij".' },
                { category: 'subject', sentence: 'De leraren vergaderen nu. ___ bespreken de planning.', answer: ['zij', 'ze'], explanation: 'Plural -> "zij/ze".' },
                { category: 'subject', sentence: '(Formal) Mevrouw, ___ kunt hier plaatsnemen.', answer: ['u'], explanation: 'Formal address uses "u".' },
                { category: 'subject', sentence: 'Jij en ik gaan morgen wandelen. ___ hebben er zin in.', answer: ['wij', 'we'], explanation: '"Jij en ik" becomes "wij/we".' },
                { category: 'subject', sentence: 'De bus komt eraan. ___ komt al!', answer: ['hij'], explanation: '"Bus" is a de-word, so "hij".' },
                { category: 'subject', sentence: 'De hond kwispelt. ___ is blij.', answer: ['hij'], explanation: 'Animals with de-word often take "hij".' },
                { category: 'subject', sentence: 'De lamp brandt niet. ___ is stuk.', answer: ['hij'], explanation: '"Lamp" is de-word -> "hij".' },
                { category: 'subject', sentence: 'De huizen zijn duur. ___ kosten veel geld.', answer: ['zij', 'ze'], explanation: 'Plural nouns -> "zij/ze".' },
                { category: 'subject', sentence: 'Emma, wil ___ nog koffie?', answer: ['jij', 'je'], explanation: 'Talking to Emma informally uses "jij/je".' },
                { category: 'subject', sentence: 'Mijn ouders komen morgen. ___ blijven twee dagen.', answer: ['zij', 'ze'], explanation: 'Plural people -> "zij/ze".' },
                { category: 'subject', sentence: 'Dit boek is oud. ___ heeft een scheur.', answer: ['het'], explanation: 'Het-word subject stays "het".' },
                { category: 'subject', sentence: 'Luca en jij werken samen. ___ maken een presentatie.', answer: ['jullie'], explanation: 'Addressing someone plus "jij" -> "jullie".' },
                { category: 'subject', sentence: 'Ik heb een nieuwe fiets. ___ rijdt heerlijk.', answer: ['hij'], explanation: '"Fiets" is de-word -> "hij".' },
                { category: 'subject', sentence: 'Mijn buurvrouw is ziek. ___ blijft thuis.', answer: ['zij'], explanation: 'Female person -> "zij".' },
                { category: 'subject', sentence: 'De meiden lachen. ___ hebben lol.', answer: ['zij', 'ze'], explanation: 'Plural feminine -> "zij/ze".' },
                { category: 'subject', sentence: 'Waar woon ___ eigenlijk?', answer: ['jij', 'je'], explanation: 'Informal question uses "jij/je".' },
                { category: 'subject', sentence: 'Onze buren verhuizen. ___ gaan naar Belgi√´.', answer: ['zij', 'ze'], explanation: 'Plural -> "zij/ze".' },
                { category: 'subject', sentence: 'Het kind huilt. ___ is moe.', answer: ['het'], explanation: '"Kind" is het-word -> "het".' },
                { category: 'subject', sentence: 'Deze koekjes zijn vers. ___ ruiken heerlijk.', answer: ['ze'], explanation: 'Plural objects -> "ze".' },
                { category: 'subject', sentence: 'Het museum opent om tien uur. ___ is gratis vandaag.', answer: ['het'], explanation: '"Museum" is het-word -> "het".' },
                { category: 'subject', sentence: 'Mijn team en ik winnen vaak. ___ trainen hard.', answer: ['wij', 'we'], explanation: '"Mijn team en ik" -> "wij/we".' },
                { category: 'subject', sentence: 'De vakantie is voorbij. ___ was te kort.', answer: ['hij'], explanation: 'De-word "vakantie" often uses "hij".' },
                { category: 'subject', sentence: 'De soep is nog heet. ___ brandt mijn tong.', answer: ['ze'], explanation: 'De-word food can use "ze".' },
                { category: 'subject', sentence: 'Floris is laat. ___ komt altijd te laat.', answer: ['hij'], explanation: 'Floris is male -> "hij".' },
                { category: 'subject', sentence: 'Dit huis is groot. ___ heeft vier slaapkamers.', answer: ['het'], explanation: '"Huis" is het-word -> "het".' },
                { category: 'subject', sentence: 'Mijn vrienden en ik gaan kamperen. ___ nemen tenten mee.', answer: ['wij', 'we'], explanation: '"Vrienden en ik" -> "wij/we".' },
                { category: 'subject', sentence: 'De auto start niet. ___ heeft geen benzine.', answer: ['hij'], explanation: '"Auto" is de-word -> "hij".' },
                { category: 'subject', sentence: 'Kinderen, ___ willen jullie wat drinken?', answer: ['jullie'], explanation: 'Addressing children -> "jullie".' },
                { category: 'subject', sentence: 'Het weer verandert. ___ wordt kouder.', answer: ['het'], explanation: 'Weather/conditions use "het".' },

                { category: 'object', sentence: 'Ik zie de postbode. Ik geef ___ een brief.', answer: ['hem'], explanation: 'Use "hem" for a male person.' },
                { category: 'object', sentence: 'Mijn vriendin is jarig. Ik bel ___ meteen.', answer: ['haar'], explanation: 'Female person -> "haar".' },
                { category: 'object', sentence: 'Dit is mijn nieuwe telefoon. Vind je ___ mooi?', answer: ['hem'], explanation: '"Telefoon" is a de-word, so object pronoun is "hem".' },
                { category: 'object', sentence: 'Ik begrijp het niet. Kun je ___ helpen?', answer: ['mij', 'me'], explanation: 'First person object is "mij/me".' },
                { category: 'object', sentence: 'Onze leraar is ziek. We sturen ___ een kaart.', answer: ['hem'], explanation: 'Male teacher -> "hem".' },
                { category: 'object', sentence: 'Waar is mijn paspoort? Heb jij ___ gezien?', answer: ['het'], explanation: 'Het-word object stays "het".' },
                { category: 'object', sentence: 'De honden hebben dorst. Ik geef ___ water.', answer: ['ze', 'hen'], explanation: 'Plural animals/people use "ze/hen".' },
                { category: 'object', sentence: 'Kijk naar ___! Ik heb een nieuwe jas.', answer: ['mij', 'me'], explanation: 'Pointing to yourself uses "mij/me".' },
                { category: 'object', sentence: '(Formal) Meneer, kan ik ___ iets vragen?', answer: ['u'], explanation: 'Formal object pronoun is "u".' },
                { category: 'object', sentence: 'Wij hebben honger. De ober brengt ___ de menukaart.', answer: ['ons'], explanation: 'First person plural object is "ons".' },
                { category: 'object', sentence: 'Ik zoek mijn sleutels. Heb jij ___ gezien?', answer: ['ze'], explanation: 'Plural things use "ze".' },
                { category: 'object', sentence: 'Onze docent legt ___ de oefening uit.', answer: ['ons'], explanation: 'First person plural object -> "ons".' },
                { category: 'object', sentence: 'De kat miauwt. Ik geef ___ eten.', answer: ['hem'], explanation: 'Animal (de-word) -> "hem".' },
                { category: 'object', sentence: 'Ik heb goede vrienden. Ik vertrouw ___ volledig.', answer: ['hen'], explanation: 'Plural people -> "hen".' },
                { category: 'object', sentence: 'Wat vind je van mijn schoenen? Vind je ___ mooi?', answer: ['ze'], explanation: 'Plural objects -> "ze".' },
                { category: 'object', sentence: 'Het spijt me. Kun je ___ vergeven?', answer: ['mij', 'me'], explanation: 'First person object pronoun.' },
                { category: 'object', sentence: 'Mijn ouders bezoeken ons vaak. We zien ___ elke week.', answer: ['hen'], explanation: 'Plural people -> "hen".' },
                { category: 'object', sentence: '(Formal) Kan ik ___ helpen, mevrouw?', answer: ['u'], explanation: 'Formal object pronoun is "u".' },
                { category: 'object', sentence: 'Je broer is hier. Ik heb ___ net gesproken.', answer: ['hem'], explanation: 'Male person -> "hem".' },
                { category: 'object', sentence: 'De kinderen zijn druk. Ik moet ___ even aanspreken.', answer: ['ze'], explanation: 'Addressing a group -> "ze".' },
                { category: 'object', sentence: 'Zij kent die acteur. Heb jij ___ ook ontmoet?', answer: ['hem'], explanation: 'Male person -> "hem".' },
                { category: 'object', sentence: 'De telefoon is kapot. Ik moet ___ laten repareren.', answer: ['hem'], explanation: 'De-word object -> "hem".' },
                { category: 'object', sentence: 'Ik lees dat boek graag. Wil je ___ lenen?', answer: ['het'], explanation: 'Het-word object remains "het".' },
                { category: 'object', sentence: 'We zagen Sara gisteren. Heb je ___ nog gebeld?', answer: ['haar'], explanation: 'Female person -> "haar".' },
                { category: 'object', sentence: 'Hij heeft een nieuwe baan. Ik feliciteer ___.', answer: ['hem'], explanation: 'Male person -> "hem".' },
                { category: 'object', sentence: 'Ik hou van bloemen. Ik koop ___ vaak voor mezelf.', answer: ['ze'], explanation: 'Plural objects -> "ze".' },
                { category: 'object', sentence: 'Maak jij dit huiswerk? Ik kan ___ later nakijken.', answer: ['het'], explanation: 'Het-word -> "het".' },
                { category: 'object', sentence: 'De buurman is aardig. Iedereen groet ___.', answer: ['hem'], explanation: 'Male neighbour -> "hem".' },
                { category: 'object', sentence: 'Ik begrijp deze zin niet. Kun je ___ uitleggen?', answer: ['hem'], explanation: 'De-word "zin" -> "hem".' },
                { category: 'object', sentence: 'Ik heb nieuwe buren. Ik moet ___ nog leren kennen.', answer: ['ze'], explanation: 'Plural -> "ze".' },
                { category: 'object', sentence: 'De lerares helpt de studenten. Ze ondersteunt ___ goed.', answer: ['hen'], explanation: 'Plural people -> "hen".' },
                { category: 'object', sentence: 'Waar is je jas? Ik zie ___ nergens.', answer: ['hem'], explanation: 'De-word "jas" -> "hem".' },
                { category: 'object', sentence: 'Het feestje was leuk. Ik vond ___ fantastisch.', answer: ['het'], explanation: 'Refers to previous event -> "het".' },
                { category: 'object', sentence: 'Onze hond is oud. We verzorgen ___ goed.', answer: ['hem'], explanation: 'Animal -> "hem".' },
                { category: 'object', sentence: 'Kunnen jullie ___ horen?', answer: ['mij', 'me'], explanation: 'First person object pronoun.' },
                { category: 'object', sentence: 'De docent geeft ___ huiswerk mee.', answer: ['jullie'], explanation: 'Addressing a group -> "jullie".' },
                { category: 'object', sentence: 'Ik koop deze tassen. Wil jij ___ dragen?', answer: ['ze'], explanation: 'Plural objects -> "ze".' },
                { category: 'object', sentence: 'Je fiets staat daar. Ik heb ___ gerepareerd.', answer: ['hem'], explanation: 'De-word "fiets" -> "hem".' },
                { category: 'object', sentence: 'Hij heeft de kinderen gezien. Hij bracht ___ een cadeau.', answer: ['hen'], explanation: 'Plural children -> "hen".' },
                { category: 'object', sentence: 'Mag ik ___ iets vragen?', answer: ['jou'], explanation: 'Informal singular object is "jou".' },

                { category: 'demonstrative', sentence: '___ boek hier is erg spannend. (het-woord)', answer: ['dit'], explanation: 'Het-word nearby -> "dit".' },
                { category: 'demonstrative', sentence: 'Zie je ___ man daar? (de-woord)', answer: ['die'], explanation: 'De-word far away -> "die".' },
                { category: 'demonstrative', sentence: '___ pen hier op mijn bureau is van mij. (de-woord)', answer: ['deze'], explanation: 'De-word nearby -> "deze".' },
                { category: 'demonstrative', sentence: '___ huis in de verte is te koop. (het-woord)', answer: ['dat'], explanation: 'Het-word far away -> "dat".' },
                { category: 'demonstrative', sentence: 'Ik wil graag ___ twee croissants hier, alstublieft.', answer: ['deze'], explanation: 'Ordering items right in front of you uses "deze".' },
                { category: 'demonstrative', sentence: 'Wat kost ___ schilderij daar aan de muur?', answer: ['dat'], explanation: 'Something far away -> "dat".' },
                { category: 'demonstrative', sentence: '___ stoelen hier zijn nieuw.', answer: ['deze'], explanation: 'Plural near objects -> "deze".' },
                { category: 'demonstrative', sentence: 'Vind je ___ jurk daar in de etalage mooi?', answer: ['die'], explanation: 'De-word far away -> "die".' },
                { category: 'demonstrative', sentence: '___ is een goed idee!', answer: ['dat'], explanation: 'Referring to a previously mentioned idea uses "dat".' },
                { category: 'demonstrative', sentence: 'Is ___ jouw glas hier?', answer: ['dit'], explanation: 'Het-word close by -> "dit".' },
                { category: 'demonstrative', sentence: '___ tafel hier is van hout. (de-woord)', answer: ['deze'], explanation: 'De-word near -> "deze".' },
                { category: 'demonstrative', sentence: 'Ik hou van ___ boek daar. (het-woord)', answer: ['dat'], explanation: 'Het-word far -> "dat".' },
                { category: 'demonstrative', sentence: '___ kinderen hier spelen luid. (de-woord)', answer: ['deze'], explanation: 'Plural near -> "deze".' },
                { category: 'demonstrative', sentence: 'Wie is ___ vrouw daar? (de-woord)', answer: ['die'], explanation: 'De-word far -> "die".' },
                { category: 'demonstrative', sentence: '___ idee vind ik goed!', answer: ['dit'], explanation: 'Referring to something just mentioned -> "dit".' },
                { category: 'demonstrative', sentence: '___ auto daar is erg duur. (de-woord)', answer: ['die'], explanation: 'De-word far -> "die".' },
                { category: 'demonstrative', sentence: 'Probeer ___ gerecht hier eens. (het-woord)', answer: ['dit'], explanation: 'Het-word near -> "dit".' },
                { category: 'demonstrative', sentence: 'Ik wil ___ appels daar. (de-woord)', answer: ['die'], explanation: 'Plural far -> "die".' },
                { category: 'demonstrative', sentence: '___ gebouw hier is modern. (het-woord)', answer: ['dit'], explanation: 'Het-word near -> "dit".' },
                { category: 'demonstrative', sentence: 'Is ___ jouw tas daar? (de-woord)', answer: ['die'], explanation: 'De-word far -> "die".' },
                { category: 'demonstrative', sentence: '___ schoenen hier passen goed. (de-woord)', answer: ['deze'], explanation: 'Plural near -> "deze".' },
                { category: 'demonstrative', sentence: 'Kun je ___ foto daar zien? (de-woord)', answer: ['die'], explanation: 'De-word far -> "die".' },
                { category: 'demonstrative', sentence: 'Ik neem ___ glas hier. (het-woord)', answer: ['dit'], explanation: 'Het-word near -> "dit".' },
                { category: 'demonstrative', sentence: '___ mensen daar wachten op de bus. (de-woord)', answer: ['die'], explanation: 'Plural far -> "die".' },
                { category: 'demonstrative', sentence: 'Wat kost ___ horloge hier? (het-woord)', answer: ['dit'], explanation: 'Het-word near -> "dit".' },
                { category: 'demonstrative', sentence: '___ boeken daar zijn interessant. (het-woord)', answer: ['die'], explanation: 'Het-word plural far -> "die".' },
                { category: 'demonstrative', sentence: 'Kijk naar ___ vogel daar boven. (de-woord)', answer: ['die'], explanation: 'De-word far -> "die".' },
                { category: 'demonstrative', sentence: '___ pakket hier is voor jou. (het-woord)', answer: ['dit'], explanation: 'Het-word near -> "dit".' },
                { category: 'demonstrative', sentence: 'Hoeveel kost ___ bloemen hier? (de-woord)', answer: ['deze'], explanation: 'Plural near -> "deze".' },
                { category: 'demonstrative', sentence: 'Ik hoef ___ taart daar niet. (de-woord)', answer: ['die'], explanation: 'De-word far -> "die".' },
                { category: 'demonstrative', sentence: '___ scherm hier is kapot. (het-woord)', answer: ['dit'], explanation: 'Het-word near -> "dit".' },
                { category: 'demonstrative', sentence: 'Zie je ___ bergen daar in de verte? (de-woord)', answer: ['die'], explanation: 'Plural far -> "die".' },
                { category: 'demonstrative', sentence: 'Ik koop ___ stoel hier. (de-woord)', answer: ['deze'], explanation: 'De-word near -> "deze".' },
                { category: 'demonstrative', sentence: '___ stuk taart hier is heerlijk. (het-woord)', answer: ['dit'], explanation: 'Het-word near -> "dit".' },
                { category: 'demonstrative', sentence: 'We bezoeken ___ stad daar morgen. (de-woord)', answer: ['die'], explanation: 'De-word far -> "die".' },
                { category: 'demonstrative', sentence: 'Kun je ___ papier hier geven? (het-woord)', answer: ['dit'], explanation: 'Het-word near -> "dit".' },
                { category: 'demonstrative', sentence: '___ kast daar is oud. (de-woord)', answer: ['die'], explanation: 'De-word far -> "die".' },
                { category: 'demonstrative', sentence: 'Ik neem ___ messen hier. (de-woord)', answer: ['deze'], explanation: 'Plural near -> "deze".' },
                { category: 'demonstrative', sentence: '___ foto hier is van mijn vakantie. (de-woord)', answer: ['deze'], explanation: 'De-word near -> "deze".' },
                { category: 'demonstrative', sentence: '___ strand daar is druk in de zomer. (het-woord)', answer: ['dat'], explanation: 'Het-word far -> "dat".' },
            ];

            // --- DOM Elements ---
            const categorySelection = document.getElementById('category-selection');
            const practiceArea = document.getElementById('practice-area');
            const completionScreen = document.getElementById('completion-screen');
            const sentenceContainer = document.getElementById('sentence-container');
            const answerInput = document.getElementById('answer-input');
            const checkBtn = document.getElementById('check-btn');
            const nextBtn = document.getElementById('next-btn');
            const feedbackMessage = document.getElementById('feedback-message');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const streakCounter = document.getElementById('streak-counter');
            const timerContainer = document.getElementById("timer-container");
            const timerBar = document.getElementById("timer-bar");
            const timerText = document.getElementById("timer-text");
            const hintBtn = document.getElementById('hint-btn');
            const hintCounter = document.getElementById('hint-counter');
            const hintMessage = document.getElementById('hint-message');
            const finalScoreEl = document.getElementById('final-score');
            const finalStreakEl = document.getElementById('final-streak');
            const highScoreEl = document.getElementById('high-score');
            const newHighScoreMessage = document.getElementById('new-high-score-message');
            const playAgainBtn = document.getElementById('play-again-btn');
            const practiceMistakesBtn = document.getElementById('practice-mistakes-btn');
            const mixedBtn = document.getElementById('mixed-btn');
            const toast = document.getElementById('toast');
            const correctSound = document.getElementById('correct-sound');
            const incorrectSound = document.getElementById('incorrect-sound');
            const completionSound = document.getElementById('completion-sound');
            const highscoreSound = document.getElementById('highscore-sound');
            const startScreen = document.getElementById("start-screen");
            const startBtn = document.getElementById("start-btn");
            const soundToggle = document.getElementById('sound-toggle');

            let soundEnabled = true;

            // --- Game State & Constants ---
            let currentSentences = [];
            let currentQuestionIndex = 0;
            let currentCategory = '';
            let score = 0;
            let currentStreak = 0;
            let bestStreakInRound = 0;
            let wrongQuestions = [];
            let totalQuestions = 10;
            let hintTokens = 3;
            let hintUsed = false;
            let achievements = {};
            let highScores = {};
            const QUESTIONS_PER_ROUND = 10;
            const UNLOCK_SCORE = 8;
            const TIME_PER_QUESTION = 20;
            let timeLeft = TIME_PER_QUESTION;
            let timerInterval;

            // --- Core Game Logic ---
            function startGame(category, customList) {
                currentCategory = category;
                let filteredSentences = customList || sentences;
                if (!customList && category !== 'mixed') {
                    filteredSentences = sentences.filter(s => s.category === category);
                }
                currentSentences = customList ? shuffleArray(filteredSentences) : shuffleArray(filteredSentences).slice(0, QUESTIONS_PER_ROUND);
                totalQuestions = currentSentences.length;

                currentQuestionIndex = 0;
                score = 0;
                currentStreak = 0;
                bestStreakInRound = 0;
                hintTokens = 3;
                hintUsed = false;
                wrongQuestions = [];
                stopTimer();
                if (category === "mixed" && !customList) {
                    timerContainer.classList.remove("hidden");
                } else {
                    timerContainer.classList.add("hidden");
                }

                updateStreakDisplay();
                updateHintDisplay();
                newHighScoreMessage.classList.add('hidden');
                categorySelection.classList.add('hidden');
                completionScreen.classList.add('hidden');
                practiceArea.classList.remove('hidden');
                displayQuestion();
            }

            function displayQuestion() {
                resetInput();
                updateProgressBar();
                const question = currentSentences[currentQuestionIndex];
                sentenceContainer.textContent = question.sentence;
                hintUsed = false;
                hintMessage.textContent = '';
                if (!timerContainer.classList.contains("hidden")) {
                    stopTimer();
                    startTimer();
                }
                updateHintDisplay();
            }

            function normalizeAnswer(ans) {
                return ans.toString()
                          .trim()
                          .toLowerCase()
                          .normalize('NFD')
                          .replace(/[\u0300-\u036f]/g, '')
                          .replace(/[.!?]/g, '');
            }

            function isCorrectAnswer(userAns, correctArray) {
                const normalizedUser = normalizeAnswer(userAns);
                return correctArray.some(a => normalizeAnswer(a) === normalizedUser);
            }

            function checkAnswer() {
                const userAnswer = answerInput.value;
                const correctAnswerArray = currentSentences[currentQuestionIndex].answer;
                
                if (!userAnswer.trim()) return;

                answerInput.disabled = true;
                stopTimer();
                hintBtn.disabled = true;
                checkBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');

                if (isCorrectAnswer(userAnswer, correctAnswerArray)) {
                    feedbackMessage.textContent = 'Correct! üéâ';
                    feedbackMessage.className = 'correct';
                    answerInput.classList.add('correct-answer');
                    if (soundEnabled && correctSound.src) correctSound.play();
                    triggerConfetti();
                    score++;
                    currentStreak++;
                    if(currentStreak > bestStreakInRound) bestStreakInRound = currentStreak;
                    checkAndAwardAchievement('onfire', currentStreak >= 5);
                } else {
                    const explanation = currentSentences[currentQuestionIndex].explanation || '';
                    let message = `Not quite. Correct was: ${correctAnswerArray.join(' / ')}`;
                    if (explanation) {
                        message += `. Tip: ${explanation}`;
                    }
                    feedbackMessage.textContent = message;
                    feedbackMessage.className = 'incorrect';
                    answerInput.classList.add('incorrect-answer');
                    if (soundEnabled && incorrectSound.src) incorrectSound.play();
                    wrongQuestions.push(currentSentences[currentQuestionIndex]);
                    currentStreak = 0;
                }
                updateStreakDisplay();
            }

            function useHint() {
                if (hintTokens > 0 && !hintUsed) {
                    hintTokens--;
                    hintUsed = true;
                    currentStreak = 0; // Cost of using a hint
                    const explanation = currentSentences[currentQuestionIndex].explanation || '';
                    hintMessage.textContent = explanation;
                    updateStreakDisplay();
                    updateHintDisplay();
                    answerInput.focus();
                }
            }

            function nextQuestion() {
                currentQuestionIndex++;
                if (currentQuestionIndex < totalQuestions) {
                    displayQuestion();
                } else {
                    showCompletion();
                }
            }

            function showCompletion() {
                stopTimer();
                // Update stats and save progress
                const oldHighScore = highScores[currentCategory] || 0;
                if (currentCategory !== 'mistakes' && score > oldHighScore) {
                    highScores[currentCategory] = score;
                }
                saveProgress();

                // Check for achievements
                checkAndAwardAchievement('beginner', true);
                if (currentCategory !== 'mistakes') {
                    checkAndAwardAchievement('specialist', score === QUESTIONS_PER_ROUND);
                    checkAndAwardAchievement('pro', currentCategory === 'mixed');
                }
                
                // Display final stats
                finalScoreEl.textContent = `${score} / ${totalQuestions}`;
                finalStreakEl.textContent = bestStreakInRound;
                if (currentCategory === 'mistakes') {
                    highScoreEl.textContent = '-';
                } else {
                    highScoreEl.textContent = `${highScores[currentCategory] || 0} / ${QUESTIONS_PER_ROUND}`;
                }
                const isNewHighScore = score > oldHighScore && score > 0 && currentCategory !== 'mistakes';
                if (isNewHighScore) {
                    newHighScoreMessage.classList.remove('hidden');
                } else {
                    newHighScoreMessage.classList.add('hidden');
                }

                practiceMistakesBtn.classList.toggle('hidden', wrongQuestions.length === 0);
                practiceArea.classList.add('hidden');
                completionScreen.classList.remove('hidden');
                updateUIFromState();
                if (soundEnabled) {
                    if (isNewHighScore && highscoreSound.src) {
                        highscoreSound.play();
                    } else if (completionSound.src) {
                        completionSound.play();
                    }
                }
            }
            
            // --- UI & Feedback ---
            function resetInput() {
                answerInput.value = '';
                answerInput.disabled = false;
                hintUsed = false;
                hintMessage.textContent = '';
                answerInput.className = '';
                feedbackMessage.textContent = '';
                feedbackMessage.className = '';
                checkBtn.classList.remove('hidden');
                nextBtn.classList.add('hidden');
                updateHintDisplay();
                answerInput.focus();
            }

            function updateProgressBar() {
                const progress = ((currentQuestionIndex) / totalQuestions) * 100;
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `Question ${currentQuestionIndex + 1} of ${totalQuestions}`;
            }

            function updateStreakDisplay() {
                if (currentStreak > 1) {
                    streakCounter.textContent = `${currentStreak} üî•`;
                } else {
                    streakCounter.textContent = '';
                }
            }

            function updateHintDisplay() {
                hintCounter.textContent = `(${hintTokens} left)`;
                hintBtn.disabled = hintTokens === 0 || hintUsed;
            }

            function triggerConfetti() {
                if (currentStreak > 0 && (currentStreak + 1) % 5 === 0) {
                    // Bigger celebration for streak milestones
                    confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
                } else {
                    confetti({ particleCount: 80, spread: 60, origin: { y: 0.7 } });
                }
            }
            

            function updateTimerDisplay() {
                const percent = (timeLeft / TIME_PER_QUESTION) * 100;
                timerBar.style.width = `${percent}%`;
                timerText.textContent = `${timeLeft}s`;
            }

            function startTimer() {
                timeLeft = TIME_PER_QUESTION;
                updateTimerDisplay();
                timerInterval = setInterval(() => {
                    timeLeft--;
                    if (timeLeft < 0) {
                        clearInterval(timerInterval);
                        handleTimeout();
                    } else {
                        updateTimerDisplay();
                    }
                }, 1000);
            }

            function stopTimer() {
                clearInterval(timerInterval);
            }

            function handleTimeout() {
                if (answerInput.disabled) return;
                const correctAnswerArray = currentSentences[currentQuestionIndex].answer;
                let message = `Time's up! Correct was: ${correctAnswerArray.join(' / ')}`;
                const explanation = currentSentences[currentQuestionIndex].explanation || '';
                if (explanation) {
                    message += `. Tip: ${explanation}`;
                }
                feedbackMessage.textContent = message;
                feedbackMessage.className = 'incorrect';
                answerInput.classList.add('incorrect-answer');
                hintBtn.disabled = true;
                answerInput.disabled = true;
                checkBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
                wrongQuestions.push(currentSentences[currentQuestionIndex]);
                currentStreak = 0;
                updateStreakDisplay();
            }
            function showToast(message) {
                toast.textContent = message;
                toast.classList.remove('hidden');
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 4000);
            }

            // --- LocalStorage & Progress ---
            function saveProgress() {
                const progress = { highScores, achievements, sound: soundEnabled };
                localStorage.setItem('safeHavenPronounGame', JSON.stringify(progress));
            }

            function loadProgress() {
                const savedProgress = JSON.parse(localStorage.getItem('safeHavenPronounGame'));
                if (savedProgress) {
                    highScores = savedProgress.highScores || {};
                    let migrated = false;
                    if (highScores.demonstratives !== undefined) {
                        if (highScores.demonstrative === undefined || highScores.demonstrative < highScores.demonstratives) {
                            highScores.demonstrative = highScores.demonstratives;
                        }
                        delete highScores.demonstratives;
                        migrated = true;
                    }
                    achievements = savedProgress.achievements || {};
                    soundEnabled = savedProgress.sound !== false;
                    if (migrated) saveProgress();
                }
            }

            function checkAndAwardAchievement(id, condition) {
                if (condition && !achievements[id]) {
                    achievements[id] = true;
                    saveProgress();
                    updateAchievementsUI();
                    const badge = document.getElementById(`badge-${id}`);
                    const message = badge.getAttribute('data-tooltip');
                    showToast(`üèÜ Achievement Unlocked: ${message}!`);
                    checkMastery();
                }
            }

            function checkMastery() {
                const required = ['beginner', 'specialist', 'onfire', 'pro'];
                const allDone = required.every(key => achievements[key]);
                if (allDone && !achievements['master']) {
                    achievements['master'] = true;
                    saveProgress();
                    updateAchievementsUI();
                    showToast('üéä You unlocked all achievements! You\'re a Pronoun Master!');
                    triggerConfetti();
                }
            }
            
            function updateUIFromState() {
                // Update achievements display
                updateAchievementsUI();

                // Update Challenge Mode button state
                const demoScore = (highScores.demonstrative !== undefined)
                                    ? highScores.demonstrative
                                    : (highScores.demonstratives || 0);
                const allUnlocked = (Number(highScores.subject || 0) >= UNLOCK_SCORE) &&
                                    (Number(highScores.object || 0) >= UNLOCK_SCORE) &&
                                    (Number(demoScore) >= UNLOCK_SCORE);
                
                if (allUnlocked) {
                    mixedBtn.disabled = false;
                    mixedBtn.removeAttribute('data-tooltip');
                } else {
                    mixedBtn.disabled = true;
                    mixedBtn.setAttribute('data-tooltip', `Score ${UNLOCK_SCORE}/10 in other categories to unlock`);
                }
            }

            function updateAchievementsUI() {
                for (const id in achievements) {
                    if (achievements[id]) {
                        document.getElementById(`badge-${id}`).classList.remove('locked');
                        document.getElementById(`badge-${id}`).classList.add('unlocked');
                    }
                }
            }

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            // --- Initial Setup & Event Listeners ---
            function updateSoundIcon() {
                const icon = soundToggle.querySelector('i');
                if (soundEnabled) {
                    icon.classList.remove('fa-volume-mute');
                    icon.classList.add('fa-volume-up');
                } else {
                    icon.classList.remove('fa-volume-up');
                    icon.classList.add('fa-volume-mute');
                }
            }

            function initialize() {
                startScreen.classList.remove("hidden");
                categorySelection.classList.add("hidden");
                practiceArea.classList.add("hidden");
                completionScreen.classList.add("hidden");
                loadProgress();
                updateUIFromState();
                updateSoundIcon();
            }

            categorySelection.addEventListener('click', (e) => {
                if (e.target.matches('button') && !e.target.disabled) {
                    startGame(e.target.dataset.category);
                }
            });

            checkBtn.addEventListener('click', checkAnswer);
            nextBtn.addEventListener('click', nextQuestion);
            hintBtn.addEventListener('click', useHint);
            soundToggle.addEventListener('click', () => {
                soundEnabled = !soundEnabled;
                updateSoundIcon();
                saveProgress();
            });
            practiceMistakesBtn.addEventListener('click', () => {
                completionScreen.classList.add('hidden');
                startGame('mistakes', wrongQuestions);
                wrongQuestions = [];
            });
            playAgainBtn.addEventListener("click", () => {
                completionScreen.classList.add("hidden");
                categorySelection.classList.remove("hidden");
            });

            startBtn.addEventListener("click", () => {
                startScreen.classList.add("hidden");
                categorySelection.classList.remove("hidden");
            });
            // Allow answering the question with Enter while the input is active
            answerInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !checkBtn.classList.contains('hidden')) {
                    checkAnswer();
                }
            });

            // Also listen globally so Enter can advance to the next question
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !nextBtn.classList.contains('hidden')) {
                    nextQuestion();
                }
            });

            initialize();
        });
    </script>

</body>
</html>